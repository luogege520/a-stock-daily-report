# 🚀 完整部署指南（从零开始）

## 📋 前置准备

### 1. 安装 Git

#### Windows 用户：

**方法一：使用官方安装包**
1. 访问：https://git-scm.com/download/win
2. 下载 Git 安装包（推荐 64-bit）
3. 运行安装包，一路点击"Next"（使用默认设置即可）
4. 安装完成后，打开命令行输入 `git --version` 验证

**方法二：使用 winget（Windows 10/11）**
```powershell
winget install --id Git.Git -e --source winget
```

安装完成后，**重启命令行窗口**。

### 2. 配置 Git（首次使用）

```bash
# 设置用户名（替换为你的 GitHub 用户名）
git config --global user.name "YOUR_USERNAME"

# 设置邮箱（替换为你的 GitHub 邮箱）
git config --global user.email "your_email@example.com"
```

### 3. 创建 GitHub 账号

如果还没有 GitHub 账号：
1. 访问：https://github.com/signup
2. 按照提示注册账号
3. 验证邮箱

---

## 🎯 部署步骤

### 步骤 1：初始化 Git 仓库

打开命令行（PowerShell 或 CMD），进入项目目录：

```bash
cd D:\阶跃AI\a-stock-daily-report
```

初始化 Git 仓库：

```bash
git init
```

添加所有文件：

```bash
git add .
```

创建初始提交：

```bash
git commit -m "Initial commit: A股晚间复盘报告自动生成系统"
```

---

### 步骤 2：在 GitHub 上创建仓库

1. **登录 GitHub**：https://github.com/

2. **创建新仓库**：
   - 点击右上角的 "+" → "New repository"
   - 或直接访问：https://github.com/new

3. **填写仓库信息**：
   ```
   Repository name: a-stock-daily-report
   Description: A股晚间复盘报告自动生成系统
   Public/Private: 选择 Public（公开）或 Private（私有）
   
   ⚠️ 重要：不要勾选以下选项：
   ❌ Add a README file
   ❌ Add .gitignore
   ❌ Choose a license
   ```

4. **点击 "Create repository"**

---

### 步骤 3：关联远程仓库并推送

创建仓库后，GitHub 会显示一个页面，复制其中的命令：

```bash
# 关联远程仓库（替换 YOUR_USERNAME 为你的 GitHub 用户名）
git remote add origin https://github.com/YOUR_USERNAME/a-stock-daily-report.git

# 切换到 main 分支
git branch -M main

# 推送代码
git push -u origin main
```

**如果推送时要求登录**：
- 用户名：你的 GitHub 用户名
- 密码：使用 Personal Access Token（不是登录密码）

**如何生成 Personal Access Token**：
1. 访问：https://github.com/settings/tokens
2. 点击 "Generate new token" → "Generate new token (classic)"
3. 设置名称：`a-stock-daily-report`
4. 勾选权限：`repo`（完整的仓库访问权限）
5. 点击 "Generate token"
6. **复制生成的 token**（只显示一次，请妥善保存）
7. 在推送时，使用 token 作为密码

---

### 步骤 4：配置 GitHub Secrets

1. **进入仓库设置**：
   - 在你的仓库页面，点击 `Settings`（设置）

2. **进入 Secrets 配置**：
   - 左侧菜单：`Secrets and variables` → `Actions`

3. **添加 Secrets**：
   点击 `New repository secret`，依次添加以下 6 个 Secrets：

#### Secret 1: STEPFUN_API_KEY
```
Name: STEPFUN_API_KEY
Secret: 你的 StepFun API Key（格式：sk-xxxxx）
```

**如何获取 StepFun API Key**：
1. 访问：https://platform.stepfun.com/
2. 注册/登录账号
3. 进入 API Keys 页面
4. 创建新的 API Key
5. 复制 Key（格式：sk-xxxxx）

#### Secret 2: SENDER_EMAIL
```
Name: SENDER_EMAIL
Secret: your@gmail.com（你的发件邮箱）
```

#### Secret 3: SENDER_PASSWORD
```
Name: SENDER_PASSWORD
Secret: 你的邮箱授权码（不是登录密码！）
```

**Gmail 授权码获取方法**：
1. 访问：https://myaccount.google.com/apppasswords
2. 如果没有看到"应用专用密码"，需要先开启两步验证：
   - 访问：https://myaccount.google.com/security
   - 开启"两步验证"
3. 返回应用专用密码页面
4. 选择"邮件"和"其他设备"
5. 点击"生成"
6. 复制 16 位授权码（格式：xxxx xxxx xxxx xxxx）

**QQ 邮箱授权码获取方法**：
1. 登录 QQ 邮箱：https://mail.qq.com/
2. 设置 → 账户 → POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务
3. 开启"SMTP服务"
4. 生成授权码
5. 复制授权码

#### Secret 4: RECIPIENT_EMAIL
```
Name: RECIPIENT_EMAIL
Secret: recipient@example.com（收件人邮箱，可以是任意邮箱）
```

#### Secret 5: SMTP_SERVER
```
Name: SMTP_SERVER
Secret: smtp.gmail.com（SMTP 服务器地址）
```

**常用邮箱的 SMTP 服务器**：
- Gmail: `smtp.gmail.com`
- QQ邮箱: `smtp.qq.com`
- 163邮箱: `smtp.163.com`
- Outlook: `smtp.office365.com`

#### Secret 6: SMTP_PORT
```
Name: SMTP_PORT
Secret: 587（SMTP 端口号）
```

**常用邮箱的 SMTP 端口**：
- Gmail: `587`
- QQ邮箱: `587`
- 163邮箱: `465` 或 `25`
- Outlook: `587`

---

### 步骤 5：启用 GitHub Actions

1. **进入 Actions 页面**：
   - 在你的仓库页面，点击顶部的 `Actions` 标签

2. **启用 Workflows**：
   - 如果看到提示："Workflows aren't being run on this forked repository"
   - 点击绿色按钮："I understand my workflows, go ahead and enable them"

3. **查看 Workflow**：
   - 你应该能看到 "Daily A-Stock Report" workflow
   - 左侧会显示这个 workflow

---

### 步骤 6：测试运行

1. **手动触发 Workflow**：
   - 点击 "Daily A-Stock Report"
   - 点击右侧的 "Run workflow" 按钮
   - 选择 "main" 分支
   - 点击绿色的 "Run workflow" 按钮

2. **查看运行状态**：
   - 页面会刷新，显示一个新的运行记录
   - 点击这个运行记录
   - 查看运行进度（约 2-5 分钟）

3. **查看运行日志**：
   - 点击 "generate-and-send-report" 任务
   - 展开每个步骤查看详细日志
   - 确认没有错误（红色 ✗）

4. **下载报告**：
   - 运行完成后，滚动到页面底部
   - 在 "Artifacts" 部分，点击下载报告文件

5. **检查邮箱**：
   - 打开收件人邮箱
   - 查找标题为 "A股晚间复盘报告 - YYYY年MM月DD日" 的邮件
   - 如果没收到，检查垃圾邮件文件夹

---

## ✅ 完成检查清单

部署完成后，请确认：

- [ ] Git 已安装并配置
- [ ] 代码已推送到 GitHub
- [ ] 6 个 Secrets 已正确配置
- [ ] GitHub Actions 已启用
- [ ] 测试运行成功（绿色 ✓）
- [ ] 可以下载报告文件
- [ ] 邮箱收到报告邮件

---

## 🎯 自动运行设置

完成以上步骤后，系统将：

- ⏰ 每个交易日（周一至周五）晚上 21:00 自动运行
- 📧 自动发送报告到你的邮箱
- 📁 自动保存报告到 Artifacts（保留 30 天）

---

## ❓ 常见问题

### Q1: Git 推送时提示 "Authentication failed"

**A:** 使用 Personal Access Token 作为密码，不是 GitHub 登录密码。

**解决方案**：
1. 生成 Token：https://github.com/settings/tokens
2. 勾选 `repo` 权限
3. 复制 Token
4. 推送时使用 Token 作为密码

### Q2: Actions 运行失败，提示 "Secret not found"

**A:** Secrets 名称拼写错误或未配置。

**解决方案**：
1. 检查 Secrets 名称是否完全一致（区分大小写）
2. 确认所有 6 个 Secrets 都已添加
3. 重新运行 Workflow

### Q3: 邮件发送失败，提示 "Authentication failed"

**A:** 邮箱授权码错误或 SMTP 配置错误。

**解决方案**：
1. 重新生成邮箱授权码
2. 确认 SMTP 服务器和端口正确
3. 检查邮箱是否开启了 SMTP 服务

### Q4: 报告生成失败，提示 "API key invalid"

**A:** StepFun API Key 错误或额度不足。

**解决方案**：
1. 检查 API Key 是否正确
2. 登录 StepFun 平台查看额度
3. 确认 API Key 格式为 `sk-xxxxx`

### Q5: 如何修改运行时间？

**A:** 编辑 `.github/workflows/daily-report.yml` 文件。

**步骤**：
1. 在 GitHub 仓库中找到该文件
2. 点击编辑（铅笔图标）
3. 修改 cron 表达式：
   ```yaml
   schedule:
     - cron: '0 13 * * 1-5'  # UTC 13:00 = 北京时间 21:00
   ```
4. 提交更改

**Cron 时间转换**：
- 北京时间 = UTC + 8 小时
- 例如：北京时间 21:00 = UTC 13:00
- 例如：北京时间 20:00 = UTC 12:00

---

## 📞 获取更多帮助

如果遇到问题：

1. **查看文档**：
   - [QUICKSTART.md](QUICKSTART.md) - 快速开始
   - [DEPLOYMENT.md](DEPLOYMENT.md) - 详细部署
   - [CHECKLIST.md](CHECKLIST.md) - 检查清单

2. **查看日志**：
   - GitHub Actions 运行日志
   - 详细的错误信息

3. **提交 Issue**：
   - 在 GitHub 仓库提交 Issue
   - 描述问题和错误信息
   - 附上相关截图

---

## 🎉 部署成功！

如果所有步骤都完成，恭喜你！

现在，系统将在每个交易日晚上 21:00 自动生成报告并发送到你的邮箱。

**祝你投资顺利！** 📈

---

**文档版本**：v1.0.0  
**最后更新**：2026-01-27
