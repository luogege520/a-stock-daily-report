# ⚠️ Gemini API 免费层级限制说明

## 📊 免费层级限制

Google Gemini API 免费层级有以下限制：

### 请求频率限制
- **每分钟最多 5 次请求** (RPM - Requests Per Minute)
- **每天最多 1500 次请求** (RPD - Requests Per Day)
- **建议请求间隔：至少 15 秒**

### Token 限制
- **每分钟最多 32,000 tokens** (TPM - Tokens Per Minute)
- **每天最多 50,000 tokens** (TPD - Tokens Per Day)

## 🎯 本项目的使用情况

### 正常使用
本项目每天只运行 **1 次**（交易日晚上 21:00），完全符合免费层级限制：
- ✅ 每天 1 次请求 << 1500 次/天
- ✅ 每次请求间隔 24 小时 >> 15 秒

### 测试时注意
在测试时请注意：
- ⚠️ 不要在 1 分钟内多次手动触发 GitHub Actions
- ⚠️ 建议测试间隔至少 **15 秒**
- ⚠️ 如果触发限制，需要等待 1 分钟后再试

## 🚫 触发限制时的错误

### 错误信息
```json
{
  "error": {
    "code": 429,
    "message": "Resource has been exhausted (e.g. check quota).",
    "status": "RESOURCE_EXHAUSTED"
  }
}
```

### 解决方案
1. **等待 1 分钟**后再次尝试
2. 检查是否在短时间内发送了多次请求
3. 如果是测试，建议间隔 15 秒以上

## 📝 已优化的措施

### 1. 移除重复的 API 调用
- ❌ 已移除：模型列表查询步骤
- ❌ 已移除：API 连接测试步骤
- ✅ 保留：仅在生成报告时调用 1 次 API

### 2. GitHub Actions 配置
```yaml
# 每天只运行 1 次
schedule:
  - cron: '0 13 * * 1-5'  # 交易日晚上 21:00 (UTC+8)

# 手动触发时请注意间隔
workflow_dispatch:
```

### 3. 本地测试建议
如果需要本地测试：
```bash
# 第一次测试
python main.py

# 等待至少 15 秒

# 第二次测试
python main.py
```

## 💡 最佳实践

### 1. 正常使用
- ✅ 让系统每天自动运行 1 次
- ✅ 不需要手动干预
- ✅ 完全符合免费限制

### 2. 测试时
- ⚠️ 手动触发测试间隔 **至少 15 秒**
- ⚠️ 不要连续多次点击 "Run workflow"
- ⚠️ 如果测试失败，等待 1 分钟后再试

### 3. 开发时
- 💡 使用测试脚本前先检查上次调用时间
- 💡 可以添加延迟：`time.sleep(15)`
- 💡 本地开发时使用模拟数据，减少 API 调用

## 📈 升级到付费版本

如果需要更高的配额，可以考虑升级：

### Gemini API 付费版本
- **Standard Tier**：
  - 每分钟 1000 次请求
  - 每天 100 万次请求
  - 按使用量计费

- **查看定价**：https://ai.google.dev/pricing

### 本项目是否需要升级？
- ❌ **不需要**：每天 1 次调用完全够用
- ✅ **免费版足够**：1500 次/天 >> 1 次/天

## 🔍 监控使用情况

### 查看配额使用
1. 访问 [Google AI Studio](https://makersuite.google.com/)
2. 查看 API 使用统计
3. 监控每日请求次数

### GitHub Actions 日志
- 查看每次运行的日志
- 确认 API 调用成功
- 检查是否有限制错误

## ❓ 常见问题

### Q1: 为什么会触发限制？
**A**: 在 1 分钟内发送了超过 5 次请求。

**解决**：
- 等待 1 分钟后再试
- 确保测试间隔至少 15 秒

### Q2: 每天运行 1 次会超限吗？
**A**: 不会。每天 1 次 << 1500 次/天的限制。

### Q3: 如何避免触发限制？
**A**: 
- 不要频繁手动触发测试
- 让系统自动运行
- 测试时间隔 15 秒以上

### Q4: 触发限制后多久恢复？
**A**: 
- **RPM 限制**：1 分钟后恢复
- **RPD 限制**：第二天 00:00 UTC 重置

## 📋 总结

✅ **本项目完全符合免费层级限制**
- 每天只调用 1 次 API
- 远低于 1500 次/天的限制
- 无需升级到付费版本

⚠️ **测试时注意**
- 手动测试间隔至少 15 秒
- 不要连续多次触发
- 触发限制后等待 1 分钟

---

**更新时间**：2026-01-29  
**版本**：v2.1.0 (Gemini 2.5 Pro)
